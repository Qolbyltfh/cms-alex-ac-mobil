<div class="p-4 sm:ml-64 bg-gray-50 min-h-screen">
    <div class="p-4 mt-16">
        <div class="relative overflow-x-auto sm:rounded-lg bg-white border border-gray-200 rounded-lg shadow p-6">
            <h4 class="text-2xl font-bold dark:text-white">Orders</h4>

            <div class="flex justify-start pt-6">
                <form class="max-w-xl flex space-x-4">
                    <div class="relative">
                        <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                            <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"/>
                            </svg>
                        </div>
                        <input type="search" id="default-search" class="block w-full p-3 ps-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Search "  />
                    </div>
                    <select id="status" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                        <option *ngFor="let status of statusOptions" [value]="status.value">
                          {{ status.name }}
                        </option>
                    </select>
                      
                    <select id="type" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                        <option selected>Filter by type</option>
                        <option value="self-deliver">Self Deliver</option>
                        <option value="mechanic-pickup">Mechanic Pick Up</option>
                    </select>
                </form>

            </div>
            
              
            <div class="my-6">
                <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400 mb-4">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-center"> No </th>
                            <th scope="col" class="px-6 py-3 text-center"> Booking Date </th>
                            <th scope="col" class="px-6 py-3 text-center"> Customer Name </th>
                            <th scope="col" class="px-6 py-3 text-center"> Car </th>
                            <th scope="col" class="px-6 py-3 text-center"> Service Type </th>
                            <th scope="col" class="px-6 py-3 text-center"> Service Date </th>
                            <th scope="col" class="px-6 py-3 text-center"> Service At </th>
                            <th scope="col" class="px-6 py-3 text-center"> Status </th>
                            <th scope="col" class="px-6 py-3 text-center"> Action </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let data of list_data; index as i" class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                            <td class="text-center align-middle">{{ checkNumberList(i) }}</td>                      
                            <td class="px-6 py-4 text-center"> {{ data.createdAt || '-'}} </td>
                            <td class="px-6 py-4 text-center"> {{ data.customer_name || '-'}} </td>
                            <td class="px-6 py-4 text-center"> {{ data.car_date || '-'}} </td>
                            <td class="px-6 py-4 text-center"> {{ data.service_type || '-'}} </td>
                            <td class="px-6 py-4 text-center"> {{ data.service_at || '-'}} </td>
                            <td class="px-6 py-4 text-center"> {{ data.company_branch?.name || '-'}}</td>
                            <td class="px-6 py-4 text-center"> {{ data.status || '-'}}</td>
                            <td class="px-6 py-4 text-right">
                                <div class="flex justify-between items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 cursor-pointer" (click)="openModal('assign_mechanic',null)">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z" />
                                    </svg>                                      
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 cursor-pointer" (click)="openModal('status',null)">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
                                    </svg>  
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 cursor-pointer" (click)="openModal('detail_order', data.id)">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z" />
                                    </svg>                                    
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <app-pagination></app-pagination>

            </div>
        </div>
    </div>
</div>

<!-- Main modal -->
<div
  *ngIf="isModalOpen"
  class="fixed inset-0 z-50 flex items-center justify-center w-full h-full bg-black bg-opacity-50"
>
  <div class="relative w-full max-w-xl p-4 max-h-full">
    <!-- Modal content -->
    <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
      <!-- Modal header -->
      <div
        class="flex items-center justify-between p-4 border-b rounded-t dark:border-gray-600"
      >
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white capitalize">
          {{ title }} 
        </h3>
        <button
          type="button"
          class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"
          (click)="closeModal()"
        >
          <svg
            class="w-3 h-3"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 14 14"
          >
            <path
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"
            />
          </svg>
          <span class="sr-only">Close modal</span>
        </button>
      </div>
      <!-- Modal body -->
      <form class="p-4" [formGroup]="form" (ngSubmit)="onSubmit()">
        <div *ngIf="title === 'status'">
            <div class="grid gap-4 mb-4 grid-cols-2">
                <div class="col-span-2">
                    <label for="status" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Status</label>
                    <select id="status-update" (change)="changeStatus(mySelect.value)" #mySelect formControlName="status" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500">
                        <option *ngFor="let status of statusOptions" [value]="status.value">{{ status.name }}</option>
                    </select>
                </div>
                <div class="col-span-2">
                    <label for="description" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Description</label>
                    <textarea id="description" formControlName="description" rows="4" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Leave a comment..."></textarea>
                </div>
            </div>
            <div *ngIf="selectedStatus === 'checking-information' || selectedStatus === 'delivery'">
                <label for="pricing" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Pricing</label>
                <div formArrayName="items">
                    <div *ngFor="let item of items.controls; let i=index" [formGroupName]="i" class="grid grid-cols-12 gap-4 pb-4">
                        <div class="col-span-1 flex justify-center items-center">
                            <button type="button" class="bg-red-500 text-white px-2 py-1 rounded-lg" (click)="removeItem(i)">-</button>
                        </div>
                        <div class="col-span-5">
                            <input type="text" name="item" id="item" formControlName="item" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" placeholder="Item Name" required>
                        </div>
                        <div class="col-span-5">
                            <input type="number" name="price" id="price" formControlName="price" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" placeholder="Item Price" required>
                        </div>
                        <div class="col-span-1 flex justify-center items-center">
                            <button type="button" class="bg-blue-500 text-white px-2 py-1 rounded-lg" (click)="addItem()">+</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        

        <div *ngIf="title === 'assign mechanic'">
            <div class="grid gap-4 mb-4 grid-cols-2">
                <div class="col-span-2">
                    <label
                    for="mechanic"
                    class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                    >Mechanic</label
                    >
                    <select
                        id="mechanic-update"
                        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                        >
                        <option *ngFor="let mechanic of mechanicOptions" [value]="mechanic.value">
                            {{ mechanic.name }}
                        </option>
                    </select>
                </div>
            </div>
        </div>
        <button
          type="submit"
          class="inline-flex items-center text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
        >
          Submit
        </button>
      </form>
    </div>
  </div>
</div>

<!-- Detail Modal  -->
<div *ngIf="isModalOpenDetail" class="fixed inset-0 z-50 flex items-center justify-center w-full h-full bg-black bg-opacity-50 overflow-y-auto py-20">
    <div class="max-h-full overflow-y-auto bg-white p-6 rounded-lg w-full max-w-3xl" style="max-width: 800px; padding: 1rem;">
    <!-- Modal content -->
    <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
        <!-- Modal header -->
        <div class="flex items-center justify-between p-4 border-b rounded-t dark:border-gray-600">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
            Detail Order
        </h3>
        <button
            type="button"
            class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"
            (click)="closeModal()"
        >
            <svg
            class="w-3 h-3"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 14 14"
            >
            <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"
            />
            </svg>
            <span class="sr-only">Close modal</span>
        </button>
        </div>
        <!-- Modal body -->
        <div class="p-4">
        <div class="grid gap-4 mb-4 grid-cols-2">
            <div class="col-span-2 grid gap-4 grid-cols-4">
                <div class="col-span-1 flex items-center justify-center">
                    <img class="w-32 h-32 object-cover" src="{{ detail_order.car_image }}" alt="car photo">
                </div>
                <div class="col-span-3 grid gap-1 grid-cols-1">
                    <div class="grid grid-cols-2">
                        <p class="text-sm font-medium text-gray-900 dark:text-white"><strong>Customer Name:</strong></p>
                        <p class="text-sm text-gray-900 dark:text-white">{{ detail_order.customer_name  || '-' }}</p>
                    </div>
                    <div class="grid grid-cols-2">
                        <p class="text-sm font-medium text-gray-900 dark:text-white"><strong>Car:</strong></p>
                        <p class="text-sm text-gray-900 dark:text-white">{{ detail_order.car_name  || '-' }} | {{ detail_order.car_plat_number  || '-' }} |  {{ detail_order.distance  || '-' }}KM </p>
                    </div>
                    <div class="grid grid-cols-2">
                        <p class="text-sm font-medium text-gray-900 dark:text-white"><strong>Company Workbrench:</strong></p>
                        <p class="text-sm text-gray-900 dark:text-white">{{ detail_order.company_branch?.name  || '-' }}</p>
                    </div>
                    <div class="grid grid-cols-2">
                        <p class="text-sm font-medium text-gray-900 dark:text-white"><strong>Mechanic:</strong></p>
                        <p class="text-sm text-gray-900 dark:text-white">{{ detail_order.mechanic_name  || '-' }}</p>
                    </div>
                    <div class="grid grid-cols-2">
                        <p class="text-sm font-medium text-gray-900 dark:text-white"><strong>Service Type:</strong></p>
                        <p class="text-sm text-gray-900 dark:text-white">{{ detail_order.service_type  || '-' }}</p>
                    </div>
                    <div class="grid grid-cols-2">
                        <p class="text-sm font-medium text-gray-900 dark:text-white"><strong>Description:</strong></p>
                        <p class="text-sm text-gray-900 dark:text-white">{{ detail_order.description  || '-' }}</p>
                    </div>
                    <div class="grid grid-cols-2">
                        <p class="text-sm font-medium text-gray-900 dark:text-white"><strong>Booking Date:</strong></p>
                        <p class="text-sm text-gray-900 dark:text-white">{{ detail_order.createdAt  || '-' }} </p>
                    </div>
                    <div class="grid grid-cols-2">
                        <p class="text-sm font-medium text-gray-900 dark:text-white"><strong>Service Date:</strong></p>
                        <p class="text-sm text-gray-900 dark:text-white">{{ detail_order.service_at || '-' }} </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid gap-4 mb-4">
            <div class="my-6">
                <p class="text-base text-gray-900 dark:text-white pb-4"><strong>Order Log</strong></p>
                <ol class="relative border-s border-gray-200 dark:border-gray-700">                  
                    <li *ngFor="let log of detail_order.order_logs" class="mb-10 ms-4">
                        <div [ngClass]="{
                            'bg-green-500': log.status === detail_order.status,
                            'bg-gray-200': log.status !== detail_order.status
                          }" class="absolute w-3 h-3 bg-gray-200 rounded-full mt-1.5 -start-1.5 border border-white dark:border-gray-900 dark:bg-gray-700"></div>
                        <time class="mb-1 text-xs font-normal leading-none text-gray-400 dark:text-gray-500">{{ reformatDate(log.createdAt) }}</time>
                        <h3 class="text-base font-semibold text-gray-900 dark:text-white">{{ log.title || '-' }}</h3>
                        <p class="text-xs font-normal text-gray-500 dark:text-gray-400">{{ log.description || '-' }}</p>
                    </li>
                </ol>
            </div>
        </div>
        
        </div>
        
    </div>
    </div>
</div>